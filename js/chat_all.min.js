"use strict";!function(){var e=[],t=document.querySelector("template").content.querySelector(".msg-block__answer"),o=document.querySelector(".msg-block__wrap");window.backend.load("http://localhost:3000/json/users.json",function(n){e=n,window.checkMsg=function(n){if(e.answer[n]){var l=t.cloneNode(!0);l.querySelector(".msg-block__text").textContent=e.answer[n];var r=new Date,c=r.getHours()+":"+r.getMinutes();window.timer(l.querySelector(".msg-block__time"),c);var i=JSON.parse(localStorage.getItem("msg"));console.log(i),i.text.push(e.answer[n]),i.date.push(c),i.answer.push(!0),localStorage.setItem("msg",JSON.stringify(i)),setTimeout(function(){o.appendChild(l)},1e3)}}},function(e){var t=document.createElement("div");t.style="z-index: 100; margin: 0 auto; text-align: center; background-color: red;",t.style.position="absolute",t.style.left=0,t.style.right=0,t.style.fontSize="30px",t.textContent=e,document.body.insertAdjacentElement("afterbegin",t)})}(),function(){var e=window.innerHeight;window.checkHeight=function(t){console.log(e<t),console.log(e+"|||"+t),e<t&&window.scrollTo(0,t)}}(),function(){var e=JSON.parse(localStorage.getItem("msg")),t=document.querySelector("template").content.querySelector(".msg-block_you"),o=document.querySelector(".msg-block__wrap"),n=document.querySelector("template").content.querySelector(".msg-block__answer"),l=document.querySelector(".time__line");window.renderOldMsg=function(){if(console.log(e),e){if(e.text.length)l.textContent=l.textContent+e.date[0],l.style.visibility="visible";else(r=document.createElement("div")).style="margin: 0 auto; text-align: center;",r.style.left=0,r.style.right=0,r.style.color="white",r.style.fontSize="30px",r.classList.add("his-clear"),r.textContent="History clear",o.appendChild(r);e.answer.forEach(function(l,r){if(l){var c=n.cloneNode(!0);c.querySelector(".msg-block__text").textContent=e.text[r],c.querySelector(".msg-block__time").textContent=e.date[r],o.appendChild(c)}else{var i=t.cloneNode(!0);i.querySelector(".msg-block__text").textContent=e.text[r],i.querySelector(".msg-block__time").textContent=e.date[r],o.appendChild(i)}})}else{var r;(r=document.createElement("div")).style="margin: 0 auto; text-align: center;",r.style.left=0,r.style.right=0,r.style.fontSize="30px",r.style.color="white",r.classList.add("his-clear"),r.textContent="History clear",o.appendChild(r)}}}(),function(){if(localStorage.getItem("auth")){window.renderOldMsg();var e=window.innerHeight+"px";if(document.querySelector(".mobile__wrap-chat").style.minHeight=e,console.log(localStorage.getItem("msg")),!localStorage.getItem("msg")){localStorage.setItem("msg",JSON.stringify({text:[],date:[],answer:[]}))}var t=document.querySelector("template").content.querySelector(".msg-block_you"),o=document.querySelector(".send-msg__form"),n=o.querySelector(".send-msg__btn"),l=document.querySelector(".msg-block__wrap"),r=o.querySelector("input[type=text]"),c=0,i=document.querySelector(".his-clear"),a=document.querySelector(".time__line"),s=function(){if(r.value){var e=t.cloneNode(!0);e.querySelector(".msg-block__text").textContent=r.value;var o=new Date,n=o.getMinutes();n<10&&(n="0"+n);var s=o.getHours()+":"+n;window.timer(e.querySelector(".msg-block__time"),s),i&&(i.style.visibility="hidden",a.textContent=a.textContent+s,a.style.visibility="visible"),l.appendChild(e);var u=document.querySelector(".msg-block__wrap").clientHeight;window.checkHeight(u);var d=JSON.parse(localStorage.getItem("msg"));d.text.push(r.value),d.date.push(s),d.answer.push(!1),localStorage.setItem("msg",JSON.stringify(d)),window.checkMsg(c++),r.value=""}};n.addEventListener("click",s),r.addEventListener("keydown",function(e){13===e.keyCode&&s()})}else window.location.href="http://localhost:3000/"}(),document.querySelector(".chat__dot-menu").addEventListener("click",function(){document.querySelector(".dot-menu").classList.toggle("active"),document.querySelectorAll(".dot-menu__item")[0].addEventListener("click",function(){localStorage.removeItem("msg"),location.reload()}),document.querySelectorAll(".dot-menu__item")[1].addEventListener("click",function(){localStorage.removeItem("auth"),location.reload()})}),window.timer=function(e,t){var o=0,n=setInterval(function(){o<600?(o++,e.textContent=o>60?Math.floor(o/60)+" minutes ago":o+" seconds ago"):(e.textContent=t,clearInterval(n))},1e3)};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFuc3dlci5qcyIsImhlaWdodENoYXQuanMiLCJyZW5kZXJNc2cuanMiLCJzZW5kTXNnLmpzIiwic2hvd01lbnUuanMiLCJ0aW1lci5qcyJdLCJuYW1lcyI6WyJtc2dUZXh0IiwidGVtcGxhdGVNc2dBbnN3ZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjb250ZW50IiwiYm9keU1zZyIsIndpbmRvdyIsImJhY2tlbmQiLCJsb2FkIiwiZGF0YSIsImNoZWNrTXNnIiwibXNnIiwiYW5zd2VyIiwibmV3TXNnQW5zdyIsImNsb25lTm9kZSIsInRleHRDb250ZW50IiwiZGF0ZSIsIkRhdGUiLCJ0aW1lIiwiZ2V0SG91cnMiLCJnZXRNaW51dGVzIiwidGltZXIiLCJ0ZW1wQW1zd2VyIiwiSlNPTiIsInBhcnNlIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsImNvbnNvbGUiLCJsb2ciLCJ0ZXh0IiwicHVzaCIsInNldEl0ZW0iLCJzdHJpbmdpZnkiLCJzZXRUaW1lb3V0IiwiYXBwZW5kQ2hpbGQiLCJlcnJvck1lc3NhZ2UiLCJub2RlIiwiY3JlYXRlRWxlbWVudCIsInN0eWxlIiwicG9zaXRpb24iLCJsZWZ0IiwicmlnaHQiLCJmb250U2l6ZSIsImJvZHkiLCJpbnNlcnRBZGphY2VudEVsZW1lbnQiLCJoZWlnaHRXaW5kb3dzIiwiaW5uZXJIZWlnaHQiLCJjaGVja0hlaWdodCIsInNjcm9sbFRvIiwiaGlzdG9yeU1zZyIsInRlbXBsYXRlTXNnSGlzdG9yeSIsInRlbXBsYXRlTXNnSGlzdG9yeUFuc3dlciIsInRpbWVMaW5lIiwicmVuZGVyT2xkTXNnIiwibGVuZ3RoIiwidmlzaWJpbGl0eSIsIm5vaGlzdG9yeSIsImNvbG9yIiwiY2xhc3NMaXN0IiwiYWRkIiwiZm9yRWFjaCIsIml0ZW0iLCJpIiwiY3VycmVudE1zZ0Fuc3dlciIsImN1cnJlbnRNc2ciLCJoZWlnaHQiLCJtaW5IZWlnaHQiLCJ0ZW1wbGF0ZU1zZyIsIm1zZ0Zvcm0iLCJidG5Nc2ciLCJpbmRleE1zZyIsImhpc3RDbGVhciIsInNlbmRNc2ciLCJ2YWx1ZSIsIm5ld01zZyIsIm1pbiIsImhlaWdodENoYXQiLCJjbGllbnRIZWlnaHQiLCJ0ZW1wIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2dCIsImtleUNvZGUiLCJsb2NhdGlvbiIsImhyZWYiLCJ0b2dnbGUiLCJxdWVyeVNlbGVjdG9yQWxsIiwicmVtb3ZlSXRlbSIsInJlbG9hZCIsImJsb2NrIiwic2Vjb25kcyIsInNlY29uZHNfdGltZXJfaWQiLCJzZXRJbnRlcnZhbCIsIk1hdGgiLCJmbG9vciIsImNsZWFySW50ZXJ2YWwiXSwibWFwcGluZ3MiOiJBQUFBLGNBQ0EsV0FDSSxJQXNCSUEsRUFBVSxHQUNWQyxFQUFvQkMsU0FBU0MsY0FBYyxZQUFZQyxRQUFRRCxjQUFjLHNCQUM3RUUsRUFBVUgsU0FBU0MsY0FBYyxvQkFxQ3JDRyxPQUFPQyxRQUFRQyxLQTdERix3Q0F5QlEsU0FBVUMsR0FDM0JULEVBQVVTLEVBQ1ZILE9BQU9JLFNBQVcsU0FBVUMsR0FDeEIsR0FBR1gsRUFBUVksT0FBT0QsR0FBTSxDQUNwQixJQUFJRSxFQUFhWixFQUFrQmEsV0FBVSxHQUM3Q0QsRUFBV1YsY0FBYyxvQkFBb0JZLFlBQWNmLEVBQVFZLE9BQU9ELEdBQzFFLElBQUlLLEVBQU8sSUFBSUMsS0FDWEMsRUFBT0YsRUFBS0csV0FBYSxJQUFNSCxFQUFLSSxhQUN4Q2QsT0FBT2UsTUFBTVIsRUFBV1YsY0FBYyxvQkFBcUJlLEdBQzNELElBQUlJLEVBQWFDLEtBQUtDLE1BQU1DLGFBQWFDLFFBQVEsUUFDakRDLFFBQVFDLElBQUlOLEdBQ1pBLEVBQVdPLEtBQUtDLEtBQUs5QixFQUFRWSxPQUFPRCxJQUNwQ1csRUFBV04sS0FBS2MsS0FBS1osR0FDckJJLEVBQVdWLE9BQU9rQixNQUFLLEdBQ3ZCTCxhQUFhTSxRQUFRLE1BQU9SLEtBQUtTLFVBQVVWLElBRTNDVyxXQUNJLFdBQ0k1QixFQUFRNkIsWUFBWXJCLElBQ3JCLFFBS0EsU0FBVXNCLEdBQ3pCLElBQUlDLEVBQU9sQyxTQUFTbUMsY0FBYyxPQUNsQ0QsRUFBS0UsTUFBUSwyRUFDYkYsRUFBS0UsTUFBTUMsU0FBVyxXQUN0QkgsRUFBS0UsTUFBTUUsS0FBTyxFQUNsQkosRUFBS0UsTUFBTUcsTUFBUSxFQUNuQkwsRUFBS0UsTUFBTUksU0FBVyxPQUV0Qk4sRUFBS3JCLFlBQWNvQixFQUNuQmpDLFNBQVN5QyxLQUFLQyxzQkFBc0IsYUFBY1IsS0EzRDFELEdBa0VBLFdBQ0ksSUFBSVMsRUFBZ0J2QyxPQUFPd0MsWUFDM0J4QyxPQUFPeUMsWUFBYyxTQUFVdEMsR0FDM0JrQixRQUFRQyxJQUFJaUIsRUFBZ0JwQyxHQUM1QmtCLFFBQVFDLElBQUlpQixFQUFlLE1BQU9wQyxHQUMvQm9DLEVBQWdCcEMsR0FDZkgsT0FBTzBDLFNBQVMsRUFBRXZDLElBTjlCLEdBWUEsV0FDSSxJQUFJd0MsRUFBYTFCLEtBQUtDLE1BQU1DLGFBQWFDLFFBQVEsUUFDN0N3QixFQUFxQmhELFNBQVNDLGNBQWMsWUFBWUMsUUFBUUQsY0FBYyxrQkFDOUVFLEVBQVVILFNBQVNDLGNBQWMsb0JBQ2pDZ0QsRUFBMkJqRCxTQUFTQyxjQUFjLFlBQVlDLFFBQVFELGNBQWMsc0JBQ3BGaUQsRUFBV2xELFNBQVNDLGNBQWMsZUFDdENHLE9BQU8rQyxhQUFlLFdBRWxCLEdBREExQixRQUFRQyxJQUFJcUIsR0FDVEEsRUFBVyxDQUNWLEdBQUlBLEVBQVdwQixLQUFLeUIsT0FZaEJGLEVBQVNyQyxZQUFjcUMsRUFBU3JDLFlBQWNrQyxFQUFXakMsS0FBSyxHQUM5RG9DLEVBQVNkLE1BQU1pQixXQUFhLGVBWnhCQyxFQUFZdEQsU0FBU21DLGNBQWMsUUFDN0JDLE1BQVEsc0NBQ2xCa0IsRUFBVWxCLE1BQU1FLEtBQU8sRUFDdkJnQixFQUFVbEIsTUFBTUcsTUFBUSxFQUN4QmUsRUFBVWxCLE1BQU1tQixNQUFRLFFBQ3hCRCxFQUFVbEIsTUFBTUksU0FBVyxPQUMzQmMsRUFBVUUsVUFBVUMsSUFBSSxhQUV4QkgsRUFBVXpDLFlBQWMsZ0JBQ3hCVixFQUFRNkIsWUFBWXNCLEdBS3hCUCxFQUFXckMsT0FBT2dELFFBQVEsU0FBVUMsRUFBTUMsR0FDdEMsR0FBR0QsRUFBSyxDQUNKLElBQUlFLEVBQW1CWixFQUF5QnJDLFdBQVUsR0FDMURpRCxFQUFpQjVELGNBQWMsb0JBQW9CWSxZQUFja0MsRUFBV3BCLEtBQUtpQyxHQUNqRkMsRUFBaUI1RCxjQUFjLG9CQUFvQlksWUFBZWtDLEVBQVdqQyxLQUFLOEMsR0FDbEZ6RCxFQUFRNkIsWUFBWTZCLE9BQ2xCLENBQ0YsSUFBSUMsRUFBYWQsRUFBbUJwQyxXQUFVLEdBQzlDa0QsRUFBVzdELGNBQWMsb0JBQW9CWSxZQUFja0MsRUFBV3BCLEtBQUtpQyxHQUMzRUUsRUFBVzdELGNBQWMsb0JBQW9CWSxZQUFja0MsRUFBV2pDLEtBQUs4QyxHQUMzRXpELEVBQVE2QixZQUFZOEIsVUFHMUIsQ0FDRixJQUFJUixHQUFBQSxFQUFZdEQsU0FBU21DLGNBQWMsUUFDN0JDLE1BQVEsc0NBQ2xCa0IsRUFBVWxCLE1BQU1FLEtBQU8sRUFDdkJnQixFQUFVbEIsTUFBTUcsTUFBUSxFQUN4QmUsRUFBVWxCLE1BQU1JLFNBQVcsT0FDM0JjLEVBQVVsQixNQUFNbUIsTUFBUSxRQUN4QkQsRUFBVUUsVUFBVUMsSUFBSSxhQUV4QkgsRUFBVXpDLFlBQWMsZ0JBQ3hCVixFQUFRNkIsWUFBWXNCLEtBL0NoQyxHQW9EQSxXQUNJLEdBQUsvQixhQUFhQyxRQUFRLFFBRW5CLENBQ0hwQixPQUFPK0MsZUFDUCxJQUFJWSxFQUFTM0QsT0FBT3dDLFlBQWMsS0FHbEMsR0FGQTVDLFNBQVNDLGNBQWMsc0JBQXNCbUMsTUFBTTRCLFVBQVlELEVBQy9EdEMsUUFBUUMsSUFBSUgsYUFBYUMsUUFBUSxTQUM1QkQsYUFBYUMsUUFBUSxPQUFRLENBTTlCRCxhQUFhTSxRQUFRLE1BQU9SLEtBQUtTLFVBTHBCLENBQ1RILEtBQVEsR0FDUmIsS0FBUSxHQUNSSixPQUFVLE1BT2xCLElBQUl1RCxFQUFjakUsU0FBU0MsY0FBYyxZQUFZQyxRQUFRRCxjQUFjLGtCQUN2RWlFLEVBQVVsRSxTQUFTQyxjQUFjLG1CQUNqQ2tFLEVBQVNELEVBQVFqRSxjQUFjLGtCQUMvQkUsRUFBVUgsU0FBU0MsY0FBYyxvQkFDakNILEVBQVVvRSxFQUFRakUsY0FBYyxvQkFDaENtRSxFQUFXLEVBQ1hDLEVBQVlyRSxTQUFTQyxjQUFjLGNBQ25DaUQsRUFBV2xELFNBQVNDLGNBQWMsZUFDbENxRSxFQUFVLFdBQ1YsR0FBSXhFLEVBQVF5RSxNQUFPLENBQ2YsSUFBSUMsRUFBU1AsRUFBWXJELFdBQVUsR0FDbkM0RCxFQUFPdkUsY0FBYyxvQkFBb0JZLFlBQWNmLEVBQVF5RSxNQUMvRCxJQUFJekQsRUFBTyxJQUFJQyxLQUNYMEQsRUFBTTNELEVBQUtJLGFBQ1p1RCxFQUFLLEtBQ0pBLEVBQU0sSUFBS0EsR0FFZixJQUFJekQsRUFBT0YsRUFBS0csV0FBYSxJQUFNd0QsRUFDbkNyRSxPQUFPZSxNQUFNcUQsRUFBT3ZFLGNBQWMsb0JBQXFCZSxHQUNwRHFELElBQ0NBLEVBQVVqQyxNQUFNaUIsV0FBYSxTQUM3QkgsRUFBU3JDLFlBQWNxQyxFQUFTckMsWUFBY0csRUFDOUNrQyxFQUFTZCxNQUFNaUIsV0FBYSxXQUVoQ2xELEVBQVE2QixZQUFZd0MsR0FDcEIsSUFBSUUsRUFBYTFFLFNBQVNDLGNBQWMsb0JBQW9CMEUsYUFDNUR2RSxPQUFPeUMsWUFBWTZCLEdBQ25CLElBQUlFLEVBQU92RCxLQUFLQyxNQUFNQyxhQUFhQyxRQUFRLFFBQzNDb0QsRUFBS2pELEtBQUtDLEtBQUs5QixFQUFReUUsT0FDdkJLLEVBQUs5RCxLQUFLYyxLQUFLWixHQUNmNEQsRUFBS2xFLE9BQU9rQixNQUFLLEdBQ2pCTCxhQUFhTSxRQUFRLE1BQU9SLEtBQUtTLFVBQVU4QyxJQUMzQ3hFLE9BQU9JLFNBQVM0RCxLQUVoQnRFLEVBQVF5RSxNQUFRLEtBR3hCSixFQUFPVSxpQkFBaUIsUUFBU1AsR0FDakN4RSxFQUFRK0UsaUJBQWlCLFVBQVcsU0FBVUMsR0FDdEIsS0FBaEJBLEVBQUlDLFNBQ0pULFdBekRSbEUsT0FBTzRFLFNBQVNDLEtBQU8seUJBRi9CLEdBb0V3QmpGLFNBQVNDLGNBQWMsbUJBQzdCNEUsaUJBQWlCLFFBQVMsV0FDcEI3RSxTQUFTQyxjQUFjLGFBQzVCdUQsVUFBVTBCLE9BQU8sVUFDaEJsRixTQUFTbUYsaUJBQWlCLG1CQUFtQixHQUMvQ04saUJBQWlCLFFBQVMsV0FDaEN0RCxhQUFhNkQsV0FBVyxPQUN4QkosU0FBU0ssV0FHQXJGLFNBQVNtRixpQkFBaUIsbUJBQW1CLEdBQ25ETixpQkFBaUIsUUFBUyxXQUM3QnRELGFBQWE2RCxXQUFXLFFBQ3hCSixTQUFTSyxhQU9qQmpGLE9BQU9lLE1BQVEsU0FBU21FLEVBQU90RSxHQUUzQixJQUFJdUUsRUFBVSxFQUVWQyxFQUFtQkMsWUFBWSxXQUMzQkYsRUFBVSxLQUNWQSxJQUVJRCxFQUFNekUsWUFETjBFLEVBQVUsR0FDVUcsS0FBS0MsTUFBTUosRUFBVSxJQUFNLGVBRTNCQSxFQUFVLGlCQUdsQ0QsRUFBTXpFLFlBQWNHLEVBQ3BCNEUsY0FBY0osS0FFbkIiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG4oZnVuY3Rpb24gKCkge1xuICAgIHZhciB1cmxNc2cgPSAnaHR0cDovL2xvY2FsaG9zdDozMDAwL2pzb24vdXNlcnMuanNvbic7XG5cbiAgICAvLyBmdW5jdGlvbiB0aW1lcihibG9jaywgdGltZSkge1xuICAgIC8vXG4gICAgLy8gICAgIHZhciBzZWNvbmRzID0gMDtcbiAgICAvL1xuICAgIC8vICAgICB2YXIgc2Vjb25kc190aW1lcl9pZCA9IHNldEludGVydmFsKGZ1bmN0aW9uKCkge1xuICAgIC8vICAgICAgICAgaWYgKHNlY29uZHMgPCA2MDApIHtcbiAgICAvLyAgICAgICAgICAgICBzZWNvbmRzICsrO1xuICAgIC8vICAgICAgICAgICAgIGlmKHNlY29uZHM+IDYwKXtcbiAgICAvLyAgICAgICAgICAgICAgICAgYmxvY2sudGV4dENvbnRlbnQgPSBNYXRoLmZsb29yKHNlY29uZHMvNjApICsgXCIgbWludXRlcyBhZ29cIjtcbiAgICAvLyAgICAgICAgICAgICB9ZWxzZXtcbiAgICAvLyAgICAgICAgICAgICAgICAgYmxvY2sudGV4dENvbnRlbnQgPSBzZWNvbmRzICsgXCIgc2Vjb25kcyBhZ29cIjtcbiAgICAvLyAgICAgICAgICAgICB9XG4gICAgLy8gICAgICAgICB9IGVsc2Uge1xuICAgIC8vICAgICAgICAgICAgIGJsb2NrLnRleHRDb250ZW50ID0gdGltZTtcbiAgICAvLyAgICAgICAgICAgICBjbGVhckludGVydmFsKHNlY29uZHNfdGltZXJfaWQpO1xuICAgIC8vICAgICAgICAgfVxuICAgIC8vICAgICB9LCAxMDAwKTtcbiAgICAvL1xuICAgIC8vIH1cblxuICAgIHZhciBtc2dUZXh0ID0gW107XG4gICAgdmFyIHRlbXBsYXRlTXNnQW5zd2VyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigndGVtcGxhdGUnKS5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoJy5tc2ctYmxvY2tfX2Fuc3dlcicpO1xuICAgIHZhciBib2R5TXNnID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1zZy1ibG9ja19fd3JhcCcpO1xuICAgIHZhciBzdWNjZXNzSGFuZGxlciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIG1zZ1RleHQgPSBkYXRhO1xuICAgICAgICB3aW5kb3cuY2hlY2tNc2cgPSBmdW5jdGlvbiAobXNnKSB7XG4gICAgICAgICAgICBpZihtc2dUZXh0LmFuc3dlclttc2ddKSB7XG4gICAgICAgICAgICAgICAgdmFyIG5ld01zZ0Fuc3cgPSB0ZW1wbGF0ZU1zZ0Fuc3dlci5jbG9uZU5vZGUodHJ1ZSk7XG4gICAgICAgICAgICAgICAgbmV3TXNnQW5zdy5xdWVyeVNlbGVjdG9yKCcubXNnLWJsb2NrX190ZXh0JykudGV4dENvbnRlbnQgPSBtc2dUZXh0LmFuc3dlclttc2ddO1xuICAgICAgICAgICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgICAgICB2YXIgdGltZSA9IGRhdGUuZ2V0SG91cnMoKSArICc6JyArIGRhdGUuZ2V0TWludXRlcygpO1xuICAgICAgICAgICAgICAgIHdpbmRvdy50aW1lcihuZXdNc2dBbnN3LnF1ZXJ5U2VsZWN0b3IoJy5tc2ctYmxvY2tfX3RpbWUnKSwgdGltZSk7XG4gICAgICAgICAgICAgICAgdmFyIHRlbXBBbXN3ZXIgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdtc2cnKSk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2codGVtcEFtc3dlcik7XG4gICAgICAgICAgICAgICAgdGVtcEFtc3dlci50ZXh0LnB1c2gobXNnVGV4dC5hbnN3ZXJbbXNnXSk7XG4gICAgICAgICAgICAgICAgdGVtcEFtc3dlci5kYXRlLnB1c2godGltZSk7XG4gICAgICAgICAgICAgICAgdGVtcEFtc3dlci5hbnN3ZXIucHVzaCh0cnVlKTtcbiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnbXNnJywgSlNPTi5zdHJpbmdpZnkodGVtcEFtc3dlcikpO1xuXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYm9keU1zZy5hcHBlbmRDaGlsZChuZXdNc2dBbnN3KVxuICAgICAgICAgICAgICAgICAgICB9LCAxMDAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIGVycm9ySGFuZGxlciA9IGZ1bmN0aW9uIChlcnJvck1lc3NhZ2UpIHtcbiAgICAgICAgdmFyIG5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgbm9kZS5zdHlsZSA9ICd6LWluZGV4OiAxMDA7IG1hcmdpbjogMCBhdXRvOyB0ZXh0LWFsaWduOiBjZW50ZXI7IGJhY2tncm91bmQtY29sb3I6IHJlZDsnO1xuICAgICAgICBub2RlLnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcbiAgICAgICAgbm9kZS5zdHlsZS5sZWZ0ID0gMDtcbiAgICAgICAgbm9kZS5zdHlsZS5yaWdodCA9IDA7XG4gICAgICAgIG5vZGUuc3R5bGUuZm9udFNpemUgPSAnMzBweCc7XG5cbiAgICAgICAgbm9kZS50ZXh0Q29udGVudCA9IGVycm9yTWVzc2FnZTtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2FmdGVyYmVnaW4nLCBub2RlKTtcbiAgICB9O1xuXG4gICAgd2luZG93LmJhY2tlbmQubG9hZCh1cmxNc2csIHN1Y2Nlc3NIYW5kbGVyLCBlcnJvckhhbmRsZXIpO1xufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGhlaWdodFdpbmRvd3MgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gICAgd2luZG93LmNoZWNrSGVpZ2h0ID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgY29uc29sZS5sb2coaGVpZ2h0V2luZG93cyA8IGRhdGEpO1xuICAgICAgICBjb25zb2xlLmxvZyhoZWlnaHRXaW5kb3dzICsnfHx8JysgZGF0YSk7XG4gICAgICAgIGlmKGhlaWdodFdpbmRvd3MgPCBkYXRhKXtcbiAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLGRhdGEpO1xuICAgICAgICB9XG4gICAgfVxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGhpc3RvcnlNc2cgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdtc2cnKSk7XG4gICAgdmFyIHRlbXBsYXRlTXNnSGlzdG9yeSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3RlbXBsYXRlJykuY29udGVudC5xdWVyeVNlbGVjdG9yKCcubXNnLWJsb2NrX3lvdScpO1xuICAgIHZhciBib2R5TXNnID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1zZy1ibG9ja19fd3JhcCcpO1xuICAgIHZhciB0ZW1wbGF0ZU1zZ0hpc3RvcnlBbnN3ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCd0ZW1wbGF0ZScpLmNvbnRlbnQucXVlcnlTZWxlY3RvcignLm1zZy1ibG9ja19fYW5zd2VyJyk7XG4gICAgdmFyIHRpbWVMaW5lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRpbWVfX2xpbmUnKTtcbiAgICB3aW5kb3cucmVuZGVyT2xkTXNnID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zb2xlLmxvZyhoaXN0b3J5TXNnKTtcbiAgICAgICAgaWYoaGlzdG9yeU1zZyl7XG4gICAgICAgICAgICBpZighaGlzdG9yeU1zZy50ZXh0Lmxlbmd0aCl7XG4gICAgICAgICAgICAgICAgdmFyIG5vaGlzdG9yeSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgICAgIG5vaGlzdG9yeS5zdHlsZSA9ICdtYXJnaW46IDAgYXV0bzsgdGV4dC1hbGlnbjogY2VudGVyOyc7XG4gICAgICAgICAgICAgICAgbm9oaXN0b3J5LnN0eWxlLmxlZnQgPSAwO1xuICAgICAgICAgICAgICAgIG5vaGlzdG9yeS5zdHlsZS5yaWdodCA9IDA7XG4gICAgICAgICAgICAgICAgbm9oaXN0b3J5LnN0eWxlLmNvbG9yID0gJ3doaXRlJztcbiAgICAgICAgICAgICAgICBub2hpc3Rvcnkuc3R5bGUuZm9udFNpemUgPSAnMzBweCc7XG4gICAgICAgICAgICAgICAgbm9oaXN0b3J5LmNsYXNzTGlzdC5hZGQoJ2hpcy1jbGVhcicpO1xuXG4gICAgICAgICAgICAgICAgbm9oaXN0b3J5LnRleHRDb250ZW50ID0gJ0hpc3RvcnkgY2xlYXInO1xuICAgICAgICAgICAgICAgIGJvZHlNc2cuYXBwZW5kQ2hpbGQobm9oaXN0b3J5KTtcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIHRpbWVMaW5lLnRleHRDb250ZW50ID0gdGltZUxpbmUudGV4dENvbnRlbnQgKyBoaXN0b3J5TXNnLmRhdGVbMF07XG4gICAgICAgICAgICAgICAgdGltZUxpbmUuc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGhpc3RvcnlNc2cuYW5zd2VyLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGkpIHtcbiAgICAgICAgICAgICAgICBpZihpdGVtKXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRNc2dBbnN3ZXIgPSB0ZW1wbGF0ZU1zZ0hpc3RvcnlBbnN3ZXIuY2xvbmVOb2RlKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50TXNnQW5zd2VyLnF1ZXJ5U2VsZWN0b3IoJy5tc2ctYmxvY2tfX3RleHQnKS50ZXh0Q29udGVudCA9IGhpc3RvcnlNc2cudGV4dFtpXTtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudE1zZ0Fuc3dlci5xdWVyeVNlbGVjdG9yKCcubXNnLWJsb2NrX190aW1lJykudGV4dENvbnRlbnQgPSAgaGlzdG9yeU1zZy5kYXRlW2ldO1xuICAgICAgICAgICAgICAgICAgICBib2R5TXNnLmFwcGVuZENoaWxkKGN1cnJlbnRNc2dBbnN3ZXIpO1xuICAgICAgICAgICAgICAgIH1lbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRNc2cgPSB0ZW1wbGF0ZU1zZ0hpc3RvcnkuY2xvbmVOb2RlKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50TXNnLnF1ZXJ5U2VsZWN0b3IoJy5tc2ctYmxvY2tfX3RleHQnKS50ZXh0Q29udGVudCA9IGhpc3RvcnlNc2cudGV4dFtpXTtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudE1zZy5xdWVyeVNlbGVjdG9yKCcubXNnLWJsb2NrX190aW1lJykudGV4dENvbnRlbnQgPSBoaXN0b3J5TXNnLmRhdGVbaV07XG4gICAgICAgICAgICAgICAgICAgIGJvZHlNc2cuYXBwZW5kQ2hpbGQoY3VycmVudE1zZyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfWVsc2Uge1xuICAgICAgICAgICAgdmFyIG5vaGlzdG9yeSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgbm9oaXN0b3J5LnN0eWxlID0gJ21hcmdpbjogMCBhdXRvOyB0ZXh0LWFsaWduOiBjZW50ZXI7JztcbiAgICAgICAgICAgIG5vaGlzdG9yeS5zdHlsZS5sZWZ0ID0gMDtcbiAgICAgICAgICAgIG5vaGlzdG9yeS5zdHlsZS5yaWdodCA9IDA7XG4gICAgICAgICAgICBub2hpc3Rvcnkuc3R5bGUuZm9udFNpemUgPSAnMzBweCc7XG4gICAgICAgICAgICBub2hpc3Rvcnkuc3R5bGUuY29sb3IgPSAnd2hpdGUnO1xuICAgICAgICAgICAgbm9oaXN0b3J5LmNsYXNzTGlzdC5hZGQoJ2hpcy1jbGVhcicpO1xuXG4gICAgICAgICAgICBub2hpc3RvcnkudGV4dENvbnRlbnQgPSAnSGlzdG9yeSBjbGVhcic7XG4gICAgICAgICAgICBib2R5TXNnLmFwcGVuZENoaWxkKG5vaGlzdG9yeSk7XG4gICAgICAgIH1cbiAgICB9XG59KSgpOyIsIid1c2Ugc3RyaWN0JztcbihmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCFsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYXV0aCcpKSB7XG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC8nO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHdpbmRvdy5yZW5kZXJPbGRNc2coKTtcbiAgICAgICAgdmFyIGhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCArICdweCc7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2JpbGVfX3dyYXAtY2hhdCcpLnN0eWxlLm1pbkhlaWdodCA9IGhlaWdodDtcbiAgICAgICAgY29uc29sZS5sb2cobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ21zZycpKTtcbiAgICAgICAgaWYgKCFsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbXNnJykpIHtcbiAgICAgICAgICAgIHZhciBtc2dWYXIgPSB7XG4gICAgICAgICAgICAgICAgXCJ0ZXh0XCI6IFtdLFxuICAgICAgICAgICAgICAgIFwiZGF0ZVwiOiBbXSxcbiAgICAgICAgICAgICAgICBcImFuc3dlclwiOiBbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdtc2cnLCBKU09OLnN0cmluZ2lmeShtc2dWYXIpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIG5vaW5zcGVjdGlvbiBKU0Fubm90YXRvclxuXG4gICAgICAgIHZhciB0ZW1wbGF0ZU1zZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3RlbXBsYXRlJykuY29udGVudC5xdWVyeVNlbGVjdG9yKCcubXNnLWJsb2NrX3lvdScpO1xuICAgICAgICB2YXIgbXNnRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZW5kLW1zZ19fZm9ybScpO1xuICAgICAgICB2YXIgYnRuTXNnID0gbXNnRm9ybS5xdWVyeVNlbGVjdG9yKCcuc2VuZC1tc2dfX2J0bicpO1xuICAgICAgICB2YXIgYm9keU1zZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tc2ctYmxvY2tfX3dyYXAnKTtcbiAgICAgICAgdmFyIG1zZ1RleHQgPSBtc2dGb3JtLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W3R5cGU9dGV4dF0nKTtcbiAgICAgICAgdmFyIGluZGV4TXNnID0gMDtcbiAgICAgICAgdmFyIGhpc3RDbGVhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5oaXMtY2xlYXInKTtcbiAgICAgICAgdmFyIHRpbWVMaW5lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRpbWVfX2xpbmUnKTtcbiAgICAgICAgdmFyIHNlbmRNc2cgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAobXNnVGV4dC52YWx1ZSkge1xuICAgICAgICAgICAgICAgIHZhciBuZXdNc2cgPSB0ZW1wbGF0ZU1zZy5jbG9uZU5vZGUodHJ1ZSk7XG4gICAgICAgICAgICAgICAgbmV3TXNnLnF1ZXJ5U2VsZWN0b3IoJy5tc2ctYmxvY2tfX3RleHQnKS50ZXh0Q29udGVudCA9IG1zZ1RleHQudmFsdWU7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgICAgIHZhciBtaW4gPSBkYXRlLmdldE1pbnV0ZXMoKTtcbiAgICAgICAgICAgICAgICBpZihtaW48IDEwKXtcbiAgICAgICAgICAgICAgICAgICAgbWluID0gXCIwXCIrIG1pbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIHRpbWUgPSBkYXRlLmdldEhvdXJzKCkgKyAnOicgKyBtaW47XG4gICAgICAgICAgICAgICAgd2luZG93LnRpbWVyKG5ld01zZy5xdWVyeVNlbGVjdG9yKCcubXNnLWJsb2NrX190aW1lJyksIHRpbWUpO1xuICAgICAgICAgICAgICAgIGlmKGhpc3RDbGVhcil7XG4gICAgICAgICAgICAgICAgICAgIGhpc3RDbGVhci5zdHlsZS52aXNpYmlsaXR5ID0gJ2hpZGRlbic7XG4gICAgICAgICAgICAgICAgICAgIHRpbWVMaW5lLnRleHRDb250ZW50ID0gdGltZUxpbmUudGV4dENvbnRlbnQgKyB0aW1lO1xuICAgICAgICAgICAgICAgICAgICB0aW1lTGluZS5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBib2R5TXNnLmFwcGVuZENoaWxkKG5ld01zZyk7XG4gICAgICAgICAgICAgICAgdmFyIGhlaWdodENoYXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubXNnLWJsb2NrX193cmFwJykuY2xpZW50SGVpZ2h0O1xuICAgICAgICAgICAgICAgIHdpbmRvdy5jaGVja0hlaWdodChoZWlnaHRDaGF0KTtcbiAgICAgICAgICAgICAgICB2YXIgdGVtcCA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ21zZycpKTtcbiAgICAgICAgICAgICAgICB0ZW1wLnRleHQucHVzaChtc2dUZXh0LnZhbHVlKTtcbiAgICAgICAgICAgICAgICB0ZW1wLmRhdGUucHVzaCh0aW1lKTtcbiAgICAgICAgICAgICAgICB0ZW1wLmFuc3dlci5wdXNoKGZhbHNlKTtcbiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnbXNnJywgSlNPTi5zdHJpbmdpZnkodGVtcCkpO1xuICAgICAgICAgICAgICAgIHdpbmRvdy5jaGVja01zZyhpbmRleE1zZysrKTtcbiAgICAgICAgICAgICAgICAvL2xvY2FsU3RvcmFnZS5jbGVhcigpO1xuICAgICAgICAgICAgICAgIG1zZ1RleHQudmFsdWUgPSBcIlwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBidG5Nc2cuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzZW5kTXNnKTtcbiAgICAgICAgbXNnVGV4dC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZnVuY3Rpb24gKGV2dCkge1xuICAgICAgICAgICAgaWYgKGV2dC5rZXlDb2RlID09PSAxMykge1xuICAgICAgICAgICAgICAgIHNlbmRNc2coKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9XG5cbn0pKCk7IiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuICAgIHZhciBkb3R0ZXJNZW51QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNoYXRfX2RvdC1tZW51Jyk7XG4gICAgZG90dGVyTWVudUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGRvdHRlck1lbnU9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5kb3QtbWVudScpO1xuICAgICAgICBkb3R0ZXJNZW51LmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScpO1xuICAgICAgICB2YXIgY2xlYXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZG90LW1lbnVfX2l0ZW0nKVswXTtcbiAgICAgICAgICAgIGNsZWFyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ21zZycpO1xuICAgICAgICAgICAgbG9jYXRpb24ucmVsb2FkKCk7XG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB2YXIgbG9nT3V0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmRvdC1tZW51X19pdGVtJylbMV07XG4gICAgICAgIGxvZ091dC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdhdXRoJyk7XG4gICAgICAgICAgICBsb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgfSlcbiAgICB9KVxufSkoKTsiLCIndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgd2luZG93LnRpbWVyID0gZnVuY3Rpb24oYmxvY2ssIHRpbWUpIHtcblxuICAgICAgICB2YXIgc2Vjb25kcyA9IDA7XG5cbiAgICAgICAgdmFyIHNlY29uZHNfdGltZXJfaWQgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoc2Vjb25kcyA8IDYwMCkge1xuICAgICAgICAgICAgICAgIHNlY29uZHMrKztcbiAgICAgICAgICAgICAgICBpZiAoc2Vjb25kcyA+IDYwKSB7XG4gICAgICAgICAgICAgICAgICAgIGJsb2NrLnRleHRDb250ZW50ID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gNjApICsgXCIgbWludXRlcyBhZ29cIjtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBibG9jay50ZXh0Q29udGVudCA9IHNlY29uZHMgKyBcIiBzZWNvbmRzIGFnb1wiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYmxvY2sudGV4dENvbnRlbnQgPSB0aW1lO1xuICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoc2Vjb25kc190aW1lcl9pZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIDEwMDApO1xuXG4gICAgfVxufSkoKTsiXSwiZmlsZSI6ImNoYXRfYWxsLm1pbi5qcyJ9
